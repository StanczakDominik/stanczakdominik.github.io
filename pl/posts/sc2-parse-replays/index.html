<!DOCTYPE html>
<html prefix="        og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="pl">
<head>
<meta charset="utf-8">
<meta name="description" content="I've realized I owe you an explanation on how to parse your own SC2 replays for the series of posts on Bayesian SC2 replay data analysis. Let's go through it!">
<meta name="viewport" content="width=device-width">
<title>Parsing SC2 replays for later analysis | Prematurely optimizing</title>
<link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" integrity="sha256-gsmEoJAws/Kd3CjuOQzLie5Q3yshhvmo7YNtBG7aaEY=" crossorigin="anonymous">
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (pl)" hreflang="pl" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://stanczakdominik.github.io/pl/posts/sc2-parse-replays/">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><script data-goatcounter="https://stanczakdominik.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script><meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett">
<link rel="stylesheet" type="text/css" href="../../../assets/css/tipuesearch.css">
<meta name="author" content="Dominik Stańczak-Marikin">
<link rel="prev" href="../bayes-sc2-part-2/" title="Learning my per-matchup MMR in Starcraft II through PyMC3" type="text/html">
<link rel="next" href="../short-updates-bayes-masters-plasmapy-protoss-julia/" title="Short updates: Bayes, Master's, PlasmaPy, Protoss, Julia" type="text/html">
<meta property="og:site_name" content="Prematurely optimizing">
<meta property="og:title" content="Parsing SC2 replays for later analysis">
<meta property="og:url" content="https://stanczakdominik.github.io/pl/posts/sc2-parse-replays/">
<meta property="og:description" content="I've realized I owe you an explanation on how to parse your own SC2 replays for the series of posts on Bayesian SC2 replay data analysis. Let's go through it!">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-06-23T19:30:00+02:00">
<meta property="article:tag" content="python">
<meta property="article:tag" content="starcraft">
<link rel="alternate" hreflang="en" href="../../../posts/sc2-parse-replays/">
</head>
<body>
    <a href="#page-content" class="sr-only sr-only-focusable">Przejdź do treści</a>
    
    <section class="social"><ul>
<li><a href="../../../index.html" title="Home"><i class="fa fa-home"></i><br>Home</a></li>
            <li><a href="../../../posts/" title="Posts"><i class="fa fa-pencil"></i><br>Posts</a></li>
            <li><a href="../../../categories/" title="Tags"><i class="fa fa-tags"></i><br>Tags</a></li>
            <li><a href="../../../rss.xml" title="RSS"><i class="fa fa-rss"></i><br>RSS</a></li>
            <li><a href="../../../about/" title="About"><i class="fa fa-user-circle-o"></i><br>About</a></li>
            <li><a href="https://github.com/StanczakDominik/stanczakdominik.github.io/tree/src" title="Site repo"><i class="fa fa-file-code-o"></i><br>Site repo</a></li>
    
    

        </ul></section><section class="page-content"><div class="content" rel="main">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Parsing SC2 replays for later analysis</a></h1>

        <div class="metadata">
            <p class="dateline"><a href="." rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2020-06-23T19:30:00+02:00" itemprop="datePublished" title="2020-06-23 19:30">2020-06-23 19:30</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                    <a href="../../authors/dominik-stanczak-marikin/">Dominik Stańczak-Marikin</a>
            </span></p>
                <p class="commentline"><i class="far fa-comment"></i>
    
        <a href="#utterances-thread">Komentarze</a>


            
        </p>
<p class="sourceline"><a href="index.ipynb" class="sourcelink"><i class="fa fa-file-code"></i> Źródło</a></p>

            

            
    <div class="tags">
<h3 class="metadata-title">
<i class="fa fa-tags"></i> Tagi:</h3>
        <ul itemprop="keywords" class="tags-ul">
<li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/starcraft/" rel="tag">starcraft</a></li>
        </ul>
</div>

        </div>
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I've realized I owe you an explanation on how to parse your own SC2 replays for the <a href="../bayes-sc2-part-2">series of posts on Bayesian SC2 replay data analysis</a>. Let's go through it here!</p>
<!-- TEASER_END -->
<p>We'll use <a href="https://github.com/ZephyrBlu/zephyrus-sc2-parser/">ZephyrBlu's zephyrus-sc2-parser</a> library, which you can download via <code>pip install zephyrus-sc2-parser</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Parsing-the-replays">Parsing the replays<a class="anchor-link" href="#Parsing-the-replays">¶</a>
</h3>
<p>This process currently dumps a boatload of warnings and exceptions, so I'm choosing to wrap the former in a <code>try</code>-<code>except</code> and simply ignore those, and ignore the thrown warnings with <code>warnings.simplefilter("ignore")</code>. Feel free to disable them on your end; but don't say I didn't warn you!</p>
<p>Note that this process takes a while, and we'll have to do some wrangling later on, so it makes more sense to parse all the replays first and have them all in memory for later. It might fail for larger datasets.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">tqdm.auto</span> <span class="k">as</span> <span class="nn">tqdm</span>
<span class="kn">import</span> <span class="nn">zephyrus_sc2_parser</span>

<span class="n">REPLAY_DIRECTORY</span> <span class="o">=</span> <span class="s2">"/home/dominik/Links/SC2Reps"</span>
<span class="n">PLAYER_NAME</span> <span class="o">=</span> <span class="s2">"Perfi"</span>

<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">)</span>
    <span class="n">replays</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">REPLAY_DIRECTORY</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.SC2Replay"</span><span class="p">))</span>
    <span class="n">parsed_replays</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">replay_file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">replays</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">replay</span> <span class="o">=</span> <span class="n">zephyrus_sc2_parser</span><span class="o">.</span><span class="n">parse_replay</span><span class="p">(</span><span class="n">replay_file</span><span class="p">,</span> <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed for </span><span class="si">{</span><span class="n">replay_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">parsed_replays</span><span class="p">[</span><span class="n">replay_file</span><span class="p">]</span> <span class="o">=</span> <span class="n">replay</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>




<div class="output_text output_subarea ">
<pre>HBox(children=(FloatProgress(value=0.0, max=506.0), HTML(value='')))</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Failed for /home/dominik/Links/SC2Reps/Ephemeron LE (27).SC2Replay: 'NoneType' object has no attribute 'race'
Failed for /home/dominik/Links/SC2Reps/Triton LE (4).SC2Replay: local variable 'game_length' referenced before assignment
Failed for /home/dominik/Links/SC2Reps/Winter's Gate LE (4).SC2Replay: local variable 'game_length' referenced before assignment
Failed for /home/dominik/Links/SC2Reps/Zen LE (4).SC2Replay: 'NoneType' object has no attribute 'race'
Failed for /home/dominik/Links/SC2Reps/World of Sleepers LE (48).SC2Replay: local variable 'game_length' referenced before assignment
Failed for /home/dominik/Links/SC2Reps/Whitewater Line LE.SC2Replay: 'NoneType' object has no attribute 'race'
Failed for /home/dominik/Links/SC2Reps/Bone Temple LE.SC2Replay: 'NoneType' object has no attribute 'race'
Failed for /home/dominik/Links/SC2Reps/Acropolis LE (19).SC2Replay: 'NoneType' object has no attribute 'race'
Failed for /home/dominik/Links/SC2Reps/World of Sleepers LE (15).SC2Replay: 'NoneType' object has no attribute 'race'
Failed for /home/dominik/Links/SC2Reps/Ephemeron LE (25).SC2Replay: 'NoneType' object has no attribute 'race'
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>--- Logging error ---
Traceback (most recent call last):
  File "/home/dominik/.local/lib/python3.8/site-packages/zephyrus_sc2_parser/parser.py", line 154, in parse_replay
    players = create_players(player_info, events)
  File "/home/dominik/.local/lib/python3.8/site-packages/zephyrus_sc2_parser/utils.py", line 68, in create_players
    new_player.race = non_english_races[new_player.race.encode('utf-8')]
KeyError: b''

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/progs/miniconda3/envs/py38/lib/python3.8/logging/__init__.py", line 1081, in emit
    msg = self.format(record)
  File "/progs/miniconda3/envs/py38/lib/python3.8/logging/__init__.py", line 925, in format
    return fmt.format(record)
  File "/progs/miniconda3/envs/py38/lib/python3.8/logging/__init__.py", line 664, in format
    record.message = record.getMessage()
  File "/progs/miniconda3/envs/py38/lib/python3.8/logging/__init__.py", line 369, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/progs/miniconda3/envs/py38/lib/python3.8/runpy.py", line 193, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/progs/miniconda3/envs/py38/lib/python3.8/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/ipykernel_launcher.py", line 16, in &lt;module&gt;
    app.launch_new_instance()
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/traitlets/config/application.py", line 664, in launch_instance
    app.start()
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/ipykernel/kernelapp.py", line 583, in start
    self.io_loop.start()
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/tornado/platform/asyncio.py", line 149, in start
    self.asyncio_loop.run_forever()
  File "/progs/miniconda3/envs/py38/lib/python3.8/asyncio/base_events.py", line 570, in run_forever
    self._run_once()
  File "/progs/miniconda3/envs/py38/lib/python3.8/asyncio/base_events.py", line 1859, in _run_once
    handle._run()
  File "/progs/miniconda3/envs/py38/lib/python3.8/asyncio/events.py", line 81, in _run
    self._context.run(self._callback, *self._args)
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/tornado/ioloop.py", line 690, in &lt;lambda&gt;
    lambda f: self._run_callback(functools.partial(callback, future))
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/tornado/ioloop.py", line 743, in _run_callback
    ret = callback()
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/tornado/gen.py", line 787, in inner
    self.run()
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/tornado/gen.py", line 748, in run
    yielded = self.gen.send(value)
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/ipykernel/kernelbase.py", line 361, in process_one
    yield gen.maybe_future(dispatch(*args))
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/tornado/gen.py", line 209, in wrapper
    yielded = next(result)
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/ipykernel/kernelbase.py", line 268, in dispatch_shell
    yield gen.maybe_future(handler(stream, idents, msg))
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/tornado/gen.py", line 209, in wrapper
    yielded = next(result)
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/ipykernel/kernelbase.py", line 539, in execute_request
    self.do_execute(
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/tornado/gen.py", line 209, in wrapper
    yielded = next(result)
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/ipykernel/ipkernel.py", line 300, in do_execute
    res = shell.run_cell(code, store_history=store_history, silent=silent)
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/ipykernel/zmqshell.py", line 536, in run_cell
    return super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/IPython/core/interactiveshell.py", line 2857, in run_cell
    result = self._run_cell(
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/IPython/core/interactiveshell.py", line 2886, in _run_cell
    return runner(coro)
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/IPython/core/async_helpers.py", line 68, in _pseudo_sync_runner
    coro.send(None)
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/IPython/core/interactiveshell.py", line 3062, in run_cell_async
    has_raised = await self.run_ast_nodes(code_ast.body, cell_name,
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/IPython/core/interactiveshell.py", line 3254, in run_ast_nodes
    if (await self.run_code(code, result,  async_=asy)):
  File "/progs/miniconda3/envs/py38/lib/python3.8/site-packages/IPython/core/interactiveshell.py", line 3331, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "&lt;ipython-input-1-d51f8f2ea671&gt;", line 16, in &lt;module&gt;
    replay = zephyrus_sc2_parser.parse_replay(replay_file, local=True)
  File "/home/dominik/.local/lib/python3.8/site-packages/zephyrus_sc2_parser/parser.py", line 162, in parse_replay
    logging.critical('A KeyError error occured:', error, 'unreadable file info')
Message: 'A KeyError error occured:'
Arguments: (KeyError(b''), 'unreadable file info')
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Failed for /home/dominik/Links/SC2Reps/Eternal Empire LE (20).SC2Replay: local variable 'game_length' referenced before assignment

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And I have absolutely no idea how to explain the <em>Logging error</em>. We aren't missing out on many games, though:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"We successfully parsed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">parsed_replays</span><span class="p">)</span><span class="si">}</span><span class="s2"> replays, which is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">parsed_replays</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">replays</span><span class="p">)</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2"> of the total!"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>We successfully parsed 464 replays, which is 97.68% of the total!
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>That was the first step; now, we continue to...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Pull-the-interesting-data">Pull the interesting data<a class="anchor-link" href="#Pull-the-interesting-data">¶</a>
</h3>
<p>Note that this mostly handles 1v1 data; it might be a bit more difficult to filter out stuff such as coop and team games. I would probably recommend filtering them out at an earlier stage, by filename.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># utility function to get our own player ID</span>
<span class="k">def</span> <span class="nf">grab_player_id</span><span class="p">(</span><span class="n">players</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">PLAYER_NAME</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">players</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">break</span>        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">key</span>


<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">replay_file</span><span class="p">,</span> <span class="n">replay</span> <span class="ow">in</span> <span class="n">parsed_replays</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">players</span><span class="p">,</span> <span class="n">timeline</span><span class="p">,</span> <span class="n">engagements</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="n">replay</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">replay</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to parse for </span><span class="si">{</span><span class="n">replay_file</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">continue</span>
    <span class="n">my_id</span> <span class="o">=</span> <span class="n">grab_player_id</span><span class="p">(</span><span class="n">players</span><span class="p">,</span> <span class="n">PLAYER_NAME</span><span class="p">)</span>
    <span class="n">enemy_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">my_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">else</span> <span class="mi">2</span>
    
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">replay_file</span> <span class="o">=</span> <span class="n">replay_file</span><span class="p">,</span>
            <span class="n">time_played_at</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">'time_played_at'</span><span class="p">],</span>
            <span class="n">win</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s2">"winner"</span><span class="p">]</span> <span class="o">==</span> <span class="n">my_id</span><span class="p">,</span>
            
            <span class="n">race</span> <span class="o">=</span> <span class="n">players</span><span class="p">[</span><span class="n">my_id</span><span class="p">]</span><span class="o">.</span><span class="n">race</span><span class="p">,</span>
            <span class="n">enemy_race</span> <span class="o">=</span> <span class="n">players</span><span class="p">[</span><span class="n">enemy_id</span><span class="p">]</span><span class="o">.</span><span class="n">race</span><span class="p">,</span>
            
            <span class="n">mmr</span> <span class="o">=</span> <span class="n">summary</span><span class="p">[</span><span class="s1">'mmr'</span><span class="p">][</span><span class="n">my_id</span><span class="p">],</span>
            
            <span class="n">enemy_mmr</span> <span class="o">=</span> <span class="n">summary</span><span class="p">[</span><span class="s1">'mmr'</span><span class="p">][</span><span class="n">enemy_id</span><span class="p">],</span>
            <span class="n">enemy_nickame</span> <span class="o">=</span> <span class="n">players</span><span class="p">[</span><span class="n">enemy_id</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            
            <span class="n">map_name</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s2">"map"</span><span class="p">],</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">'game_length'</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"We successfully pulled data out of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> replays, which is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">replays</span><span class="p">)</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2"> of the total!"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Failed to parse for /home/dominik/Links/SC2Reps/Ephemeron LE (24).SC2Replay
Failed to parse for /home/dominik/Links/SC2Reps/Malwarfare.SC2Replay
We successfully pulled data out of 462 replays, which is 97.26% of the total!
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What I'm showing you here is the end result, but if you wanted to add some other metrics, you might be interested in the answer to:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="How-do-I-pick-the-interesting-data?">How do I pick the interesting data?<a class="anchor-link" href="#How-do-I-pick-the-interesting-data?">¶</a>
</h4>
<p>We'll use the entries from the last replay. Most of them are dictionaries, so it's pretty easy to get access to their contents:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">meta</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[42]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>{'time_played_at': datetime.datetime(2020, 4, 30, 18, 34, 1, tzinfo=&lt;UTC&gt;),
 'map': 'Nightshade LE',
 'game_length': 1040,
 'winner': 2}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you run this notebook locally, IPython has a nice widget to browse this data. If you're reading this on the website, you'll probably unfortunately see only <code>&lt;IPython.core.display.JSON object&gt;</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">JSON</span>
<span class="n">JSON</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;IPython.core.display.JSON object&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">summary</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[44]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>dict_keys(['mmr', 'avg_resource_collection_rate', 'avg_unspent_resources', 'apm', 'spm', 'resources_lost', 'resources_collected', 'workers_produced', 'workers_killed', 'workers_lost', 'supply_block', 'sq', 'avg_pac_per_min', 'avg_pac_action_latency', 'avg_pac_actions', 'avg_pac_gap', 'race'])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As you can (possibly) see, there's plenty of interesting data that I might use sometime. Beyond what we're already pulling out:</p>
<ul>
<li>Average resource collection rate</li>
<li>the <a href="https://liquipedia.net/starcraft2/Spending_quotient">spending quotient</a>, a (possibly flawed) measure of macro skill</li>
<li>time spent supply blocked</li>
<li>workers lost, killed and produced</li>
<li>per-race statistics:<ul>
<li>Orbital Command energy efficiency and idle time</li>
<li>likewise for Nexii (Nexuses?)</li>
<li>Splash efficiency for Protoss</li>
</ul>
</li>
</ul>
<p>I probably wouldn't use Bayesian inference on all of them, though - it gets hard to come up with a model that involves all of them. Maybe a random forest model would be nice?</p>
<p>Either way, once we've found something interesting it's simple to access the fields:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [45]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">summary</span><span class="p">[</span><span class="s1">'apm'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[45]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>151.0</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It's a bit more difficult to pull data out of <code>players</code>, as there are dedicated objects storing the data there; we can still make do:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">player_id</span><span class="p">,</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">players</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># we have to drop some data that contains custom objects:</span>
    <span class="k">for</span> <span class="n">dropped_key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"current_selection"</span><span class="p">,</span> <span class="s2">"objects"</span><span class="p">,</span> <span class="s2">"control_groups"</span><span class="p">,</span> <span class="s2">"pac_list"</span><span class="p">,</span> <span class="s2">"current_pac"</span><span class="p">,</span> <span class="s2">"active_ability"</span><span class="p">]:</span>
        <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">dropped_key</span><span class="p">)</span>
    <span class="n">clean_data</span><span class="p">[</span><span class="n">player_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
<span class="n">JSON</span><span class="p">(</span><span class="n">clean_data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[46]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;IPython.core.display.JSON object&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I'll showcase a few:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">players</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">upgrades</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[48]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>['WarpGateResearch',
 'ExtendedThermalLance',
 'Charge',
 'ProtossGroundWeaponsLevel1',
 'PsiStormTech',
 'GraviticDrive',
 'BlinkTech',
 'ProtossGroundWeaponsLevel2',
 'AdeptPiercingAttack',
 'ProtossGroundArmorsLevel1',
 'ProtossGroundWeaponsLevel3',
 'ProtossShieldsLevel1']</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [50]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">players</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">supply_block</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[50]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>1568</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [52]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">players</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">resources_collected</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[52]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>{'minerals': 31370, 'gas': 11109}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A bunch of these keys, such as <code>unspent_resources</code>, are time data, taken at discrete snapshots during the game. There's more time data, of course, in <code>timeline</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">JSON</span><span class="p">(</span><span class="n">timeline</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[40]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;IPython.core.display.JSON object&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And I haven't yet been able to figure this one out:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [54]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">engagements</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[54]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Saving-our-results-to-DataFrame,-then-to-CSV">Saving our results to DataFrame, then to CSV<a class="anchor-link" href="#Saving-our-results-to-DataFrame,-then-to-CSV">¶</a>
</h3>
<p>We'll also calculate the MMR difference at this step.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'mmr_diff'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mmr</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">enemy_mmr</span>
<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[4]:</div>



<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>time_played_at</th>
      <th>win</th>
      <th>race</th>
      <th>enemy_race</th>
      <th>mmr</th>
      <th>enemy_mmr</th>
      <th>enemy_nickame</th>
      <th>map_name</th>
      <th>duration</th>
      <th>mmr_diff</th>
    </tr></thead>
<tbody>
<tr>
<th>0</th>
      <td>2020-05-27 10:32:29+00:00</td>
      <td>True</td>
      <td>Protoss</td>
      <td>Terran</td>
      <td>4004</td>
      <td>4173</td>
      <td>giletjaune</td>
      <td>Nightshade LE</td>
      <td>601</td>
      <td>-169</td>
    </tr>
<tr>
<th>1</th>
      <td>2020-06-09 17:11:15+00:00</td>
      <td>False</td>
      <td>Protoss</td>
      <td>Zerg</td>
      <td>4186</td>
      <td>4147</td>
      <td>djakette</td>
      <td>Eternal Empire LE</td>
      <td>420</td>
      <td>39</td>
    </tr>
<tr>
<th>2</th>
      <td>2020-02-02 17:27:27+00:00</td>
      <td>True</td>
      <td>Protoss</td>
      <td>Terran</td>
      <td>3971</td>
      <td>3913</td>
      <td>Syocto</td>
      <td>Ephemeron LE</td>
      <td>10</td>
      <td>58</td>
    </tr>
<tr>
<th>3</th>
      <td>2019-12-20 18:53:00+00:00</td>
      <td>True</td>
      <td>Zerg</td>
      <td>Terran</td>
      <td>2984</td>
      <td>3090</td>
      <td>Jason</td>
      <td>Simulacrum LE</td>
      <td>569</td>
      <td>-106</td>
    </tr>
<tr>
<th>4</th>
      <td>2019-12-09 20:36:21+00:00</td>
      <td>True</td>
      <td>Protoss</td>
      <td>Zerg</td>
      <td>4015</td>
      <td>4024</td>
      <td>&amp;lt;OGCOСK&amp;gt;&lt;sp/&gt;ShushYo</td>
      <td>Nightshade LE</td>
      <td>454</td>
      <td>-9</td>
    </tr>
<tr>
<th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
<tr>
<th>457</th>
      <td>2019-11-04 20:53:20+00:00</td>
      <td>False</td>
      <td>Protoss</td>
      <td>Terran</td>
      <td>3800</td>
      <td>3883</td>
      <td>&amp;lt;MiClan&amp;gt;&lt;sp/&gt;MiSHANYA</td>
      <td>Disco Bloodbath LE</td>
      <td>396</td>
      <td>-83</td>
    </tr>
<tr>
<th>458</th>
      <td>2020-05-04 12:43:06+00:00</td>
      <td>True</td>
      <td>Protoss</td>
      <td>Terran</td>
      <td>3926</td>
      <td>3831</td>
      <td>StaMinA</td>
      <td>Golden Wall LE</td>
      <td>784</td>
      <td>95</td>
    </tr>
<tr>
<th>459</th>
      <td>2020-02-02 17:15:06+00:00</td>
      <td>False</td>
      <td>Protoss</td>
      <td>Zerg</td>
      <td>4012</td>
      <td>4092</td>
      <td>&amp;lt;0mg&amp;gt;&lt;sp/&gt;Sroljo</td>
      <td>World of Sleepers LE</td>
      <td>264</td>
      <td>-80</td>
    </tr>
<tr>
<th>460</th>
      <td>2020-04-19 11:48:32+00:00</td>
      <td>True</td>
      <td>Protoss</td>
      <td>Zerg</td>
      <td>0</td>
      <td>0</td>
      <td>shadowofmich</td>
      <td>Simulacrum LE</td>
      <td>297</td>
      <td>0</td>
    </tr>
<tr>
<th>461</th>
      <td>2020-04-30 18:34:01+00:00</td>
      <td>True</td>
      <td>Protoss</td>
      <td>Terran</td>
      <td>3964</td>
      <td>4055</td>
      <td>&amp;lt;BRs&amp;gt;&lt;sp/&gt;GoodFellas</td>
      <td>Nightshade LE</td>
      <td>1040</td>
      <td>-91</td>
    </tr>
</tbody>
</table>
<p>462 rows × 10 columns</p>
</div></div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And we dump that to CSV, and we're done!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"/home/dominik/Writing/blog/files/replays.csv"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="TL;DR-version">TL;DR version<a class="anchor-link" href="#TL;DR-version">¶</a>
</h3>
<p>Feel free to take this script and modify as you see fit!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">tqdm.auto</span> <span class="k">as</span> <span class="nn">tqdm</span>
<span class="kn">import</span> <span class="nn">zephyrus_sc2_parser</span>

<span class="n">REPLAY_DIRECTORY</span> <span class="o">=</span> <span class="s2">"/home/dominik/Links/SC2Reps"</span>
<span class="n">PLAYER_NAME</span> <span class="o">=</span> <span class="s2">"Perfi"</span>
<span class="n">OUTPUT_CSV</span> <span class="o">=</span> <span class="s2">"/home/dominik/Writing/blog/files/replays.csv"</span>

<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">)</span>
    <span class="n">replays</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">REPLAY_DIRECTORY</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.SC2Replay"</span><span class="p">))</span>
    <span class="n">parsed_replays</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">replay_file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">replays</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">replay</span> <span class="o">=</span> <span class="n">zephyrus_sc2_parser</span><span class="o">.</span><span class="n">parse_replay</span><span class="p">(</span><span class="n">replay_file</span><span class="p">,</span> <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed for </span><span class="si">{</span><span class="n">replay_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">parsed_replays</span><span class="p">[</span><span class="n">replay_file</span><span class="p">]</span> <span class="o">=</span> <span class="n">replay</span>
        
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"We successfully pulled data out of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> replays, which is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">replays</span><span class="p">)</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2"> of the total!"</span><span class="p">)</span>

<span class="c1"># utility function to get our own player ID</span>
<span class="k">def</span> <span class="nf">grab_player_id</span><span class="p">(</span><span class="n">players</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">PLAYER_NAME</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">players</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">break</span>        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">key</span>


<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">replay_file</span><span class="p">,</span> <span class="n">replay</span> <span class="ow">in</span> <span class="n">parsed_replays</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">players</span><span class="p">,</span> <span class="n">timeline</span><span class="p">,</span> <span class="n">engagements</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="n">replay</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">replay</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to parse for </span><span class="si">{</span><span class="n">replay_file</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">continue</span>
    <span class="n">my_id</span> <span class="o">=</span> <span class="n">grab_player_id</span><span class="p">(</span><span class="n">players</span><span class="p">,</span> <span class="n">PLAYER_NAME</span><span class="p">)</span>
    <span class="n">enemy_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">my_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">else</span> <span class="mi">2</span>
    
    <span class="n">mmr</span> <span class="o">=</span> <span class="n">summary</span><span class="p">[</span><span class="s1">'mmr'</span><span class="p">][</span><span class="n">my_id</span><span class="p">]</span>

    <span class="n">enemy_mmr</span> <span class="o">=</span> <span class="n">summary</span><span class="p">[</span><span class="s1">'mmr'</span><span class="p">][</span><span class="n">enemy_id</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">replay_file</span> <span class="o">=</span> <span class="n">replay_file</span><span class="p">,</span>
            <span class="n">time_played_at</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">'time_played_at'</span><span class="p">],</span>
            <span class="n">win</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s2">"winner"</span><span class="p">]</span> <span class="o">==</span> <span class="n">my_id</span><span class="p">,</span>
            <span class="n">mmr</span><span class="o">=</span><span class="n">mmr</span><span class="p">,</span>
            <span class="n">enemy_mmr</span><span class="o">=</span><span class="n">enemy_mmr</span><span class="p">,</span>
            <span class="n">mmr_diff</span> <span class="o">=</span> <span class="n">mmr</span> <span class="o">-</span> <span class="n">enemy_mmr</span>
            <span class="n">race</span> <span class="o">=</span> <span class="n">players</span><span class="p">[</span><span class="n">my_id</span><span class="p">]</span><span class="o">.</span><span class="n">race</span><span class="p">,</span>
            <span class="n">enemy_race</span> <span class="o">=</span> <span class="n">players</span><span class="p">[</span><span class="n">enemy_id</span><span class="p">]</span><span class="o">.</span><span class="n">race</span><span class="p">,</span>
            <span class="n">enemy_nickame</span> <span class="o">=</span> <span class="n">players</span><span class="p">[</span><span class="n">enemy_id</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">map_name</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s2">"map"</span><span class="p">],</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">'game_length'</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"We successfully pulled data out of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> replays, which is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">replays</span><span class="p">)</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2"> of the total!"</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'mmr_diff'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mmr</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">enemy_mmr</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">OUTPUT_CSV</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you have questions about this sort of thing, I'll be happy to help - ask away! :)</p>

</div>
</div>
</div>


<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script>
</div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../bayes-sc2-part-2/" rel="prev" title="Learning my per-matchup MMR in Starcraft II through PyMC3">Poprzedni post</a>
            </li>
            <li class="next">
                <a href="../short-updates-bayes-masters-plasmapy-protoss-julia/" rel="next" title="Short updates: Bayes, Master's, PlasmaPy, Protoss, Julia">Następny post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Komentarze</h2>
        
    
        <div data-title="Parsing SC2 replays for later analysis" id="utterances-thread"></div>
        <script src="https://utteranc.es/client.js" repo="StanczakDominik/stanczakdominik.github.io" issue-term="pathname" label="Comments" theme="github-light" crossorigin="anonymous"></script></section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script></article><footer id="footer"><p>Contents © 2023         <a rel="me" href="https://mastodon.social/@StanczakDominik">Dominik Stańczak-Marikin</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a> - 
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="../../../images/creativecommons.png"></a></p>
            
        </footer>
</div>
    </section><script src="../../../assets/js/all-nocdn.js"></script><script src="https://polyfill.io/v3/polyfill.js?features=Intl.RelativeTimeFormat.%7Elocale.pl"></script><script src="../../../assets/js/luxon.min.js"></script><!-- fancy dates --><script>
    moment.locale("pl");
    fancydates(2, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
